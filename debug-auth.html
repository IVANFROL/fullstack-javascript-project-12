<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Auth</title>
</head>
<body>
    <h1>Debug Authentication</h1>
    <div id="output"></div>
    
    <script>
        async function testAuth() {
            const output = document.getElementById('output');
            
            try {
                // Очищаем localStorage
                localStorage.clear();
                output.innerHTML += '<p>LocalStorage очищен</p>';
                
                // Тестируем авторизацию
                const response = await fetch('http://localhost:5001/api/v1/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    output.innerHTML += `<p>Авторизация успешна: ${JSON.stringify(data)}</p>`;
                    
                    // Сохраняем токен
                    localStorage.setItem('jwtToken', data.token);
                    output.innerHTML += '<p>Токен сохранен в localStorage</p>';
                    
                    // Проверяем токен
                    const savedToken = localStorage.getItem('jwtToken');
                    output.innerHTML += `<p>Токен из localStorage: ${savedToken ? 'найден' : 'не найден'}</p>`;
                    
                    // Тестируем запрос с токеном
                    const channelsResponse = await fetch('http://localhost:5001/api/v1/channels', {
                        headers: {
                            'Authorization': `Bearer ${data.token}`
                        }
                    });
                    
                    if (channelsResponse.ok) {
                        const channels = await channelsResponse.json();
                        output.innerHTML += `<p>Каналы получены: ${JSON.stringify(channels)}</p>`;
                    } else {
                        output.innerHTML += `<p>Ошибка получения каналов: ${channelsResponse.status}</p>`;
                    }
                } else {
                    output.innerHTML += `<p>Ошибка авторизации: ${response.status}</p>`;
                }
            } catch (error) {
                output.innerHTML += `<p>Ошибка: ${error.message}</p>`;
            }
        }
        
        testAuth();
    </script>
</body>
</html>
